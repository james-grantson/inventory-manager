"use client"

import { useState, useEffect } from 'react'
import ConnectionStatus from './components/ConnectionStatus'
import CurrencySelector from './components/CurrencySelector'
import CurrencyDisplay from './components/CurrencyDisplay'

export default function Home() {
  const [backendStatus, setBackendStatus] = useState('checking...')
  const [features, setFeatures] = useState<string[]>([])
  const [testResult, setTestResult] = useState('')

  const checkBackend = async () => {
    try {
      const response = await fetch('https://inventory-manager-api-ghana.vercel.app/api/health')
      if (response.ok) {
        const data = await response.json()
        setBackendStatus(' Connected - ' + data.message)
        setFeatures(data.features || [])
      } else {
        setBackendStatus(' Connection failed')
      }
    } catch (error) {
      setBackendStatus(' Connection error')
    }
  }

  // Test PDF generation
  const testPDF = async () => {
    try {
      setTestResult('Generating PDF...')
      const response = await fetch('https://inventory-manager-api-ghana.vercel.app/api/reports/pdf/test')
      
      if (response.ok && response.headers.get('content-type')?.includes('application/pdf')) {
        const blob = await response.blob()
        const url = window.URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = 'inventory-test.pdf'
        document.body.appendChild(a)
        a.click()
        window.URL.revokeObjectURL(url)
        document.body.removeChild(a)
        setTestResult('✅ PDF downloaded successfully!')
      } else {
        const text = await response.text()
        setTestResult('❌ Unexpected response: ' + text.substring(0, 100))
      }
    } catch (error: any) {
      setTestResult('❌ Error: ' + error.message)
    }
  }

  // Get available currencies
  const getCurrencies = async () => {
    try {
      const response = await fetch('https://inventory-manager-api-ghana.vercel.app/api/currencies')
      const data = await response.json()
      return data.currencies || {}
    } catch (error) {
      console.error('Failed to fetch currencies:', error)
      return {}
    }
  }

  // Currency conversion example
  const convertCurrency = async () => {
    try {
      const response = await fetch('https://inventory-manager-api-ghana.vercel.app/api/currencies/convert?amount=1000&from=GHS&to=USD')
      const data = await response.json()
      alert(`Currency Conversion: 1000 GHS = ${data.conversion.to.amount} USD (Rate: ${data.conversion.rate})`)
    } catch (error) {
      console.error('Conversion failed:', error)
    }
  }

  useEffect(() => {
    checkBackend()
  }, [])

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        
        {/* Header */}
        <header className="mb-8 text-center">
          <h1 className="text-4xl font-bold text-gray-800 mb-2">
            Inventory Management System
          </h1>
          <p className="text-lg text-gray-600">
            Professional inventory system with PDF reports & multi-currency support
          </p>
          <div className="mt-4 flex flex-wrap justify-center gap-4">
            <div className="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium">
               Backend: inventory-manager-api-ghana.vercel.app
            </div>
            <div className="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium">
               PDF Reports Ready
            </div>
            <div className="bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium">
               5 Currencies Supported
            </div>
          </div>
        </header>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
          {/* Left Column: System Status */}
          <div className="lg:col-span-2 space-y-6">
            
            {/* Connection Status */}
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">System Status</h2>
              <div className="p-4 bg-gray-50 rounded-lg">
                <p className="font-medium">Backend Status: <span className={backendStatus.includes('') ? 'text-green-600' : 'text-red-600'}>
                  {backendStatus}
                </span></p>
                <button 
                  onClick={checkBackend}
                  className="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"
                >
                  Refresh Status
                </button>
              </div>
            </div>

            {/* Currency Features */}
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">Currency Features</h2>
              
              <div className="mb-6">
                <CurrencySelector />
              </div>

              <div className="space-y-4">
                <div className="p-4 bg-gray-50 rounded-lg">
                  <h3 className="font-semibold text-gray-700 mb-2">Example Display:</h3>
                  <div className="space-y-3">
                    <p>Product Price: <CurrencyDisplay amount={499.99} /></p>
                    <p>Total Inventory Value: <CurrencyDisplay amount={15000.75} /></p>
                    <p>Monthly Revenue: <CurrencyDisplay amount={250000} /></p>
                  </div>
                </div>

                <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <h3 className="font-semibold text-blue-700 mb-2">Currency Conversion</h3>
                  <p className="text-sm text-gray-600 mb-3">Test currency conversion API:</p>
                  <button 
                    onClick={convertCurrency}
                    className="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 font-medium"
                  >
                    Convert 1000 GHS to USD
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Right Column: PDF Reports */}
          <div className="space-y-6">
            
            {/* PDF Reports Card */}
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-4"> PDF Reports</h2>
              <p className="text-gray-600 mb-6">Generate professional inventory reports</p>
              
              <div className="space-y-4">
                <div className="p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200">
                  <h3 className="font-bold text-blue-700 mb-2">Test PDF Generation</h3>
                  <p className="text-sm text-gray-600 mb-3">Download a test PDF to verify the system is working</p>
                  <button 
                    onClick={testPDF}
                    className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold flex items-center justify-center"
                  >
                    <span className="mr-2"></span>
                    Download Test PDF
                  </button>
                </div>

                <div className="p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-xl border border-green-200">
                  <h3 className="font-bold text-green-700 mb-2">Quick Summary Report</h3>
                  <p className="text-sm text-gray-600 mb-3">Basic inventory overview</p>
                  <button 
                    onClick={() => alert('Coming soon! Use Test PDF for now.')}
                    className="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
                  >
                    Generate Summary
                  </button>
                </div>

                <div className="p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl border border-purple-200">
                  <h3 className="font-bold text-purple-700 mb-2">Full Inventory Report</h3>
                  <p className="text-sm text-gray-600 mb-3">Complete product listing</p>
                  <button 
                    onClick={() => alert('Coming soon! Use Test PDF for now.')}
                    className="w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold"
                  >
                    Generate Full Report
                  </button>
                </div>
              </div>

              {testResult && (
                <div className={`mt-4 p-3 rounded-lg ${testResult.includes('') ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>
                  {testResult}
                </div>
              )}
            </div>

            {/* Features List */}
            <div className="bg-gradient-to-br from-gray-800 to-gray-900 text-white rounded-2xl shadow-xl p-6">
              <h2 className="text-2xl font-bold mb-4">✨ System Features</h2>
              <ul className="space-y-3">
                {features.length > 0 ? (
                  features.map((feature, index) => (
                    <li key={index} className="flex items-center">
                      <span className="mr-2">✓</span>
                      {feature}
                    </li>
                  ))
                ) : (
                  <>
                    <li className="flex items-center">
                      <span className="mr-2">✓</span>
                      PDF Report Generation
                    </li>
                    <li className="flex items-center">
                      <span className="mr-2">✓</span>
                      Multi-Currency Support (5 currencies)
                    </li>
                    <li className="flex items-center">
                      <span className="mr-2"></span>
                      Ghana Cedis () Formatting
                    </li>
                    <li className="flex items-center">
                      <span className="mr-2"></span>
                      Professional Dashboard
                    </li>
                    <li className="flex items-center">
                      <span className="mr-2"></span>
                      Real-time Connection Status
                    </li>
                  </>
                )}
              </ul>
            </div>
          </div>
        </div>

        {/* Footer */}
        <footer className="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
          <p>Inventory Management System v3.0  Backend: inventory-manager-api-ghana.vercel.app</p>
          <p className="mt-1">Features: PDF Reports  Currency Support  Real-time Updates  Professional Dashboard</p>
        </footer>
      </div>
    </div>
  )
}


